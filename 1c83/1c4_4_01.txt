&НаКлиенте
Процедура Выгрузка(Команда)
	
	//проверка
	ОчиститьСообщения();
	Если Не ПроверитьЗаполнение() Тогда
		Возврат;
	КонецЕсли;
	Если Объект.СвернутыеПроводки.Количество() = 0 Тогда
		ТекстСообщения = НСтр("ru = 'Нет данных по проводкам!'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		Возврат;
	КонецЕсли;
	
	//информация
	ТекстСообщения = НСтр("ru = 'Выгрузка в RS ...'");
	Состояние(ТекстСообщения);
	
	//параметры
	ИмяФайла = СформироватьИмяФайлаВыгрузки(Объект.ПутьВыгрузки);
	
	//формирование файла
	СтруктураДанных = ПолучитьСтруктуруДанныхПоДокументу();
	Текст = ПолучитьТекстСРазделителями(СтруктураДанных);
	Если Текст = "" Тогда
		ТекстСообщения = НСтр("ru = 'Нет проводок для выгрузки!'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
		Возврат;
	КонецЕсли;
	
	//сохранение файла
	ЗаписатьИсторию = Ложь;
	Попытка
		
		ЗаписьТекста = Новый ЗаписьТекста(ИмяФайла, "windows-1251");
		ЗаписьТекста.Записать(Текст);
		ЗаписьТекста.Закрыть();	
		ЗаписатьИсторию = Истина;
		
	Исключение
		ТекстСообщения = СокрЛП(ОписаниеОшибки());
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
	КонецПопытки;
	
	//запись истории выгрузки для всех документов
	Если ЗаписатьИсторию = Истина Тогда
		Для Каждого СтрокаДокумента Из Объект.Документы Цикл
			ЗаписатьИсториюВыгрузки(СтрокаДокумента.ДокументСсылка);
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

//полная выгрузка из 1С
Процедура ПолнаяВыгрузкаИз1С() Экспорт
		
	//проверка блокировки
	КонфИд=СокрЛП(Метаданные.КраткаяИнформация);
	
	//общие проверки
	Если СокрЛП(ФормИмяФайлаДанных)="" Тогда
		Сообщить("Не указано имя файла выгрузки!");
		Возврат;
	КонецЕсли;
	
	файлXML=новый ЗаписьXML;
	файлXML.ОткрытьФайл(ФормИмяФайлаДанных,"UTF-8");
	файлXML.ЗаписатьОбъявлениеXML();
		
	//создание таблицы контрагентов из списка платежных поручений
	КонтрагентыТЗ=Новый ТаблицаЗначений;
	КонтрагентыТЗ=ТаблицаДокТЗ.Выгрузить();	
	КонтрагентыТЗ.Свернуть("Контрагент, Договор");	
	КонтрагентыТЗ.Колонки.Добавить("Платежи");
	
	Для каждого СтрКонтрагентыТЗ из КонтрагентыТЗ цикл
		СтрКонтрагентыТЗ.Платежи = Новый ТаблицаЗначений;
        СтрКонтрагентыТЗ.Платежи.Колонки.Добавить("Платеж");
		Для каждого СтрПлатежей из ТаблицаДокТЗ Цикл
			Если СтрКонтрагентыТЗ.Контрагент = СтрПлатежей.Контрагент И СтрКонтрагентыТЗ.Договор = СтрПлатежей.Договор Тогда 
				СтрКонтрагентыТЗ.Платежи.Добавить().Платеж=СтрПлатежей.Ссылка;
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
	ИнформУзел 		= Новый ТаблицаЗначений;
	КонтрагентыУзлы	= Новый ТаблицаЗначений;
	
	//создание корневого узла
	СоздатьУзел(ИнформУзел,"information",КонтрагентыУзлы);
	
	//заполнение узлов "user" (контрагентами)
	Для каждого СтрКонтрагентыТЗ из КонтрагентыТЗ цикл
		СоздатьУзел(КонтрагентыУзлы,"user",РеквизитыПлатежиКонтрагента(СтрКонтрагентыТЗ));
	конеццикла;
	
	ЗаписатьТЗвXML(файлXML, ИнформУзел);
	ФайлXML.Закрыть();
	Сообщить("Выгрузка [Полная] успешно завершена!");
	
КонецПроцедуры

//записывает в открытый XML таблицу значений, включая вложенные таблицы.
Процедура ЗаписатьТЗвXML(ХМЛ, ТЗ) Экспорт
	
	Для каждого Стр из ТЗ цикл
		ХМЛ.ЗаписатьНачалоЭлемента(Стр.Узел);
		Если Стр.id<>Неопределено И Стр.id<>"" Тогда
			ХМЛ.ЗаписатьАтрибут("id",стр.id);
		КонецЕсли;
		Если ТипЗнч(Стр.Значение)=Тип("ТаблицаЗначений") тогда
			ЗаписатьТЗвXML(ХМЛ,Стр.Значение);			
		Иначе 
			ХМЛ.ЗаписатьТекст(""""+сокрЛП(Стр.Значение)+"""");
		КонецЕсли;			
		ХМЛ.ЗаписатьКонецЭлемента();
	КонецЦикла  	
	
КонецПроцедуры

//создание узла в xml
Процедура СоздатьУзел(ТЗ,ИмяУзла,ЗначениеУзла,Ид=неопределено) Экспорт
	
	Если ТЗ.Колонки.Найти("Узел")=Неопределено Тогда
		ТЗ.Колонки.Добавить("Узел")
	КонецЕсли;
	
	Если ТЗ.Колонки.Найти("Значение")=Неопределено Тогда
		ТЗ.Колонки.Добавить("Значение")
	КонецЕсли;
	
	Если ТЗ.Колонки.Найти("id")=Неопределено Тогда
		ТЗ.Колонки.Добавить("id")
	КонецЕсли;
	
	стр			= ТЗ.Добавить();
	стр.Узел	= ИмяУзла;	
	стр.Значение= ЗначениеУзла;
	стр.id		= Ид;
	
КонецПроцедуры

//Загрузка из Excel
Процедура ЗагрузкаЗаявокИзЕксел() Экспорт 
	
	//Читаем из константы путь к катологу
	РабПапка=СокрЛП(Константы.ПутьДокуметов_Excel.Получить());
	Если РабПапка="" Тогда
		Сообщить("Укажите рабочаю папку с файлами Excel (Операции -> Константы -> Настройка программы)");
		Возврат;
	КонецЕсли;
	
	//Выбираем и обрабатываем все файлы Excel в папке
	Попытка
		Ексел = Новый COMОбъект("Excel.Application");
	Исключение
		Предупреждение("Не удалось инициализировать MS Excel", СтатусСообщения.Важное);
		ЗагруженНормально=Ложь;
		Возврат;
	КонецПопытки;
	
	ДокЗаявки=Документы.ЗаявкиПодразделений;
	СпрНоменклатура=Справочники.НоменклатураПЭО;
	СпрСотрудники=Справочники.СотрудникиПЭО;
	СпрПодразделения=Справочники.ПодразделенияПЭО;
	Учреждение_Раб=Справочники.Организации.НайтиПоКоду("000001");
	ЕдиницаИзмерения=Справочники.КлассификаторЕдиницИзмерения.НайтиПоКоду("796");
	Баланс_Раб=Справочники.Баланс.НайтиПоКоду("000001");
	
	ОчиститьСообщения();
	СписокФайлов=НайтиФайлы(РабПапка, "*.xls");
	Для Ном=0 По СписокФайлов.ВГраница() Цикл
		ПутьФайла=СписокФайлов[Ном].ПолноеИмя;
		Сообщить("-------------------------------------------------------------------------------------", СтатусСообщения.БезСтатуса);
		Сообщить("Обнаружен фаил - "+ПутьФайла+". Загрузка ...", СтатусСообщения.Обычное);
		
		//загружаем фаил
		НачатьТранзакцию();
		Состояние=Истина;
		Ексел.Workbooks.Open(ПутьФайла);
		Для Каждого Лист Из Ексел.Sheets Цикл
			 ИмяРаздела = ВРег(Лист.Name);
			Если ИмяРаздела="ТИТУЛЬНИК" Тогда
				//----------------------------------------------------
				//ТИТУЛЬНИК
				//	Чтение данных
				ВнутреннийНомер_Раб=СокрЛП(Лист.Range("A3:I3").Cells(1,1).Value);
				ИсполнительТекст_Раб=СокрЛП(Лист.Range("A7:I7").Cells(1,1).Value);
				ИсполнительТекст2=РасчётыДляПЭО.СтрокаДляОтбора(ИсполнительТекст_Раб, 2);
				Если ИсполнительТекст2="" Тогда
					Исполнитель_Раб=СпрСотрудники.ПустаяСсылка();
					Состояние=Ложь;
					Сообщить("Ошибка - Титульный лист. Не указан исполнитель!", СтатусСообщения.БезСтатуса);
				Иначе
					Исполнитель_Раб=СпрСотрудники.НайтиПоРеквизиту("УникальноеНаименование", ИсполнительТекст2);
					Если (Исполнитель_Раб=СпрСотрудники.ПустаяСсылка()) И (Состояние=Истина) Тогда
						Исполнитель2=СпрСотрудники.СоздатьЭлемент();
						Исполнитель2.Наименование=ИсполнительТекст_Раб;
						Исполнитель2.УникальноеНаименование=ИсполнительТекст2;
						Текст=ИсполнительТекст_Раб;
						Фамилия="";Имя="";Отчество="";
						Для НН1=1 По 3 Цикл
							Для НН2=1 По СтрДлина(Текст) Цикл
								Буква=Сред(Текст, НН2, 1);
								Если Буква=" " Тогда
									Прервать;
								КонецЕсли;
								Если НН1=1 Тогда
									Фамилия=Фамилия+Буква;
								ИначеЕсли НН1=2 Тогда
									Имя=Имя+Буква;
								ИначеЕсли НН1=3 Тогда
									Отчество=Отчество+Буква;
								КонецЕсли; 
							КонецЦикла;
							Текст=СокрЛП(Сред(Текст, НН2, 150));
						КонецЦикла;
						Исполнитель2.Фамилия=Фамилия;
						Исполнитель2.Имя=Имя;
						Исполнитель2.Отчество=Отчество;
						Исполнитель2.Записать();
						Исполнитель_Раб=Исполнитель2.Ссылка;
					КонецЕсли; 
				КонецЕсли;
				ПодразделениеКод_Раб=СокрЛП(Лист.Range("A5:I5").Cells(1,1).Value);
				ПодразделениеКод_Раб=РасчётыДляПЭО.СтрокаДляОтбора(ПодразделениеКод_Раб, 1);
				Если ПодразделениеКод_Раб="" Тогда
					Подразделение_Раб=СпрПодразделения.ПустаяСсылка();
					Состояние=Ложь;
					Сообщить("Ошибка - Титульный лист. Не указано подразделение!", СтатусСообщения.БезСтатуса);
				Иначе
					Подразделение_Раб=СпрПодразделения.НайтиПоКоду(ПодразделениеКод_Раб);
					Если (Подразделение_Раб=СпрПодразделения.ПустаяСсылка()) И (Состояние=Истина) Тогда
						Подразделение2=СпрПодразделения.СоздатьЭлемент();
						Подразделение2.Код=ПодразделениеКод_Раб;
						Подразделение2.Наименование=ПодразделениеКод_Раб;
						Подразделение2.Записать();
						Подразделение_Раб=Подразделение2.Ссылка;
					КонецЕсли; 
				КонецЕсли;
				Примечание_Раб=СокрЛП(Лист.Range("A9:I9").Cells(1,1).Value);
				//	Формирование документа ЗаявкиПодразделений
				Если Состояние=Ложь Тогда
					Продолжить;
				Иначе 
					//Создаём документ
					Док=ДокЗаявки.СоздатьДокумент();
					Док.Дата=ТекущаяДата();
					Док.Учреждение=Учреждение_Раб;
					Док.Баланс=Баланс_Раб;
					Док.ВнутреннийНомер=ВнутреннийНомер_Раб;
					Док.Исполнитель=Исполнитель_Раб;
					Док.ИсполнительТекст=ИсполнительТекст_Раб;
					Док.Подразделение=Подразделение_Раб;
					Док.ПодразделениеКод=ПодразделениеКод_Раб;
					Док.Примечание=Примечание_Раб;
					Док.КВД=Перечисления.КВД.Бюджет;
					Док.Записать(РежимЗаписиДокумента.Запись);
				КонецЕсли; 
				
			ИначеЕсли (ИмяРаздела="МАТЕРИАЛЫ") и (Состояние=Истина) Тогда
				//МАТЕРИАЛЫ
				РабЗона=Лист.Range("B5:F54");
				Для НомерСтроки=1 По 50 Цикл
					Попытка
						//	Чтение данных по каждой строке
						Колонка=1;
						Номенклатура=СокрЛП(РабЗона.Cells(НомерСтроки,1).Value);
						НомПоиск=РасчётыДляПЭО.СтрокаДляОтбора(Номенклатура, 3);
						Если НомПоиск="" Тогда
							Продолжить;
						КонецЕсли; 
						НоменклатураПЭО=СпрНоменклатура.НайтиПоРеквизиту("УникальноеНаименование", НомПоиск, СпрНоменклатура.Материалы);
						Если НоменклатураПЭО=СпрНоменклатура.ПустаяСсылка() Тогда
							Номенклатура2=СпрНоменклатура.СоздатьЭлемент();
							Номенклатура2.Родитель=СпрНоменклатура.Материалы;
							Номенклатура2.Наименование=Номенклатура;
							Номенклатура2.УникальноеНаименование=НомПоиск;
							Номенклатура2.Записать();
							НоменклатураПЭО=Номенклатура2.Ссылка;
						КонецЕсли; 
						Колонка=2;
						КолвоТекст=СокрЛП(РабЗона.Cells(НомерСтроки,4).Value);
						Колво=Число(?(КолвоТекст="", 0, КолвоТекст));
						Колонка=3;
						ЦенаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,5).Value);
						Цена=Число(?(ЦенаТекст="", 0, ЦенаТекст));
						Колонка=4;
						Сумма=Колво*Цена;
						Колонка=5;
						ОбоснованиеЦены=СокрЛП(РабЗона.Cells(НомерСтроки,6).Value);
						//	Запись данных по каждой строке
						ЗатратыНаМатериалы=Док.ЗатратыНаМатериалы.Добавить();
						ЗатратыНаМатериалы.НоменклатураПЭО=НоменклатураПЭО;
						ЗатратыНаМатериалы.Колво=Колво;
						ЗатратыНаМатериалы.Цена=Цена;
						ЗатратыНаМатериалы.Сумма=Сумма;
						ЗатратыНаМатериалы.ОбоснованиеЦены=ОбоснованиеЦены;
					Исключение
						Состояние=Ложь;
						Сообщить("Ошибка: лист-Материалы, строка № "+Строка(НомерСтроки)+", колонка № "+Строка(Колонка), СтатусСообщения.БезСтатуса);
					КонецПопытки;
				КонецЦикла;
				Док.Записать(РежимЗаписиДокумента.Запись);
				
			ИначеЕсли (ИмяРаздела="ОС") и (Состояние=Истина) Тогда
				//ОС
				РабЗона=Лист.Range("B5:J54");
				Для НомерСтроки=1 По 50 Цикл
					Попытка
						//	Чтение данных по каждой строке
						Колонка=1;
						Номенклатура=СокрЛП(РабЗона.Cells(НомерСтроки,1).Value);
						НомПоиск=РасчётыДляПЭО.СтрокаДляОтбора(Номенклатура, 3);
						Если НомПоиск="" Тогда
							Продолжить;
						КонецЕсли; 
						НоменклатураПЭО=СпрНоменклатура.НайтиПоРеквизиту("УникальноеНаименование", НомПоиск, СпрНоменклатура.ОС);
						Если НоменклатураПЭО=СпрНоменклатура.ПустаяСсылка() Тогда
							Номенклатура2=СпрНоменклатура.СоздатьЭлемент();
							Номенклатура2.Родитель=СпрНоменклатура.ОС;
							Номенклатура2.Наименование=Номенклатура;
							Номенклатура2.УникальноеНаименование=НомПоиск;
							Номенклатура2.Записать();
							НоменклатураПЭО=Номенклатура2.Ссылка;
						КонецЕсли;
						Колонка=2;
						Поставщик=ВРег(СокрЛП(РабЗона.Cells(НомерСтроки,2).Value));
						Колонка=3;
						ВидПоставщикаТекст=РасчётыДляПЭО.СтрокаДляОтбора(СокрЛП(РабЗона.Cells(НомерСтроки,3).Value), 1);
						Если ВидПоставщикаТекст="1" Тогда
							ВидПоставщика=Перечисления.ВидПоставщикаВЗаявке.Производитель;
						Иначе
							ВидПоставщика=Перечисления.ВидПоставщикаВЗаявке.Посредник;
						КонецЕсли;
						Колонка=4;
						КолвоТекст=СокрЛП(РабЗона.Cells(НомерСтроки,4).Value);
						Колво=Число(?(КолвоТекст="", 0, КолвоТекст));
						Колонка=5;
						ЦенаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,5).Value);
						Цена=Число(?(ЦенаТекст="", 0, ЦенаТекст));
						Колонка=6;
						Сумма=Колво*Цена;
						Колонка=7;
						ЗатратыТранспортировкиТекст=СокрЛП(РабЗона.Cells(НомерСтроки,7).Value);
						ЗатратыТранспортировки=Число(?(ЗатратыТранспортировкиТекст="", 0, ЗатратыТранспортировкиТекст));
						Колонка=8;
						ИтогоЗатрат=Сумма+ЗатратыТранспортировки;
						Колонка=9;
						ОбоснованиеЗакупки=СокрЛП(РабЗона.Cells(НомерСтроки,9).Value);
						//	Запись данных по каждой строке
						ЗатратыНаСпецОборудование=Док.ЗатратыНаСпецОборудование.Добавить();
						ЗатратыНаСпецОборудование.НоменклатураПЭО=НоменклатураПЭО;
						ЗатратыНаСпецОборудование.Поставщик=Поставщик;
						ЗатратыНаСпецОборудование.ВидПоставщика=ВидПоставщика;
						ЗатратыНаСпецОборудование.Колво=Колво;
						ЗатратыНаСпецОборудование.Цена=Цена;
						ЗатратыНаСпецОборудование.Сумма=Сумма;
						ЗатратыНаСпецОборудование.ЗатратыТранспортировки=ЗатратыТранспортировки;
						ЗатратыНаСпецОборудование.ИтогоЗатрат=ИтогоЗатрат;
						ЗатратыНаСпецОборудование.ОбоснованиеЗакупки=ОбоснованиеЗакупки;
					Исключение
						Состояние=Ложь;
						Сообщить("Ошибка: лист-ОС, строка № "+Строка(НомерСтроки)+", колонка № "+Строка(Колонка), СтатусСообщения.БезСтатуса);
					КонецПопытки;
				КонецЦикла;
				Док.Записать(РежимЗаписиДокумента.Запись);
				
			ИначеЕсли (ИмяРаздела="УСЛУГИ") и (Состояние=Истина) Тогда
				//УСЛУГИ
				РабЗона=Лист.Range("B6:H55");
				Для НомерСтроки=1 По 50 Цикл
					Попытка
						//	Чтение данных по каждой строке
						Колонка=1;
						Контрагент=ВРег(СокрЛП(РабЗона.Cells(НомерСтроки,1).Value));
						Колонка=2;
						Номенклатура=СокрЛП(РабЗона.Cells(НомерСтроки,2).Value);
						НомПоиск=РасчётыДляПЭО.СтрокаДляОтбора(Номенклатура, 3);
						Если НомПоиск="" Тогда
							Продолжить;
						КонецЕсли; 
						НоменклатураПЭО=СпрНоменклатура.НайтиПоРеквизиту("УникальноеНаименование", НомПоиск, СпрНоменклатура.Услуги);
						Если НоменклатураПЭО=СпрНоменклатура.ПустаяСсылка() Тогда
							Номенклатура2=СпрНоменклатура.СоздатьЭлемент();
							Номенклатура2.Родитель=СпрНоменклатура.Услуги;
							Номенклатура2.Наименование=Номенклатура;
							Номенклатура2.УникальноеНаименование=НомПоиск;
							Номенклатура2.Записать();
							НоменклатураПЭО=Номенклатура2.Ссылка;
						КонецЕсли;
						Колонка=3;
						ДатаНачалаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,3).Value);
						ДатаНачала=?(ДатаНачалаТекст="", "", Дата(ДатаНачалаТекст));
						Колонка=4;
						ДатаОкончанияТекст=СокрЛП(РабЗона.Cells(НомерСтроки,4).Value);
						ДатаОкончания=?(ДатаОкончанияТекст="", "", Дата(ДатаОкончанияТекст));
						Колонка=5;
						СуммаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,5).Value);
						Сумма=Число(?(СуммаТекст="", 0, СуммаТекст));
						Колонка=6;
						СуммаТекГодаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,6).Value);
						СуммаТекГода=Число(?(СуммаТекГодаТекст="", 0, СуммаТекГодаТекст));
						Колонка=7;
						Обоснование=СокрЛП(РабЗона.Cells(НомерСтроки,7).Value);
						//	Запись данных по каждой строке
						ЗатратыПоУслугам=Док.ЗатратыПоУслугам.Добавить();
						ЗатратыПоУслугам.Контрагент=Контрагент;
						ЗатратыПоУслугам.НоменклатураПЭО=НоменклатураПЭО;
						ЗатратыПоУслугам.ДатаНачала=ДатаНачала;
						ЗатратыПоУслугам.ДатаОкончания=ДатаОкончания;
						ЗатратыПоУслугам.Сумма=Сумма;
						ЗатратыПоУслугам.СуммаТекГода=СуммаТекГода;
						ЗатратыПоУслугам.Обоснование=Обоснование;
					Исключение
						Состояние=Ложь;
						Сообщить("Ошибка: лист-Услуги, строка № "+Строка(НомерСтроки)+", колонка № "+Строка(Колонка), СтатусСообщения.БезСтатуса);
					КонецПопытки;
				КонецЦикла;
				Док.Записать(РежимЗаписиДокумента.Запись);
				
			ИначеЕсли (ИмяРаздела="КОМАНДИРОВКИ") и (Состояние=Истина) Тогда
				//КОМАНДИРОВКИ
				РабЗона=Лист.Range("B7:M66");
				Для НомерСтроки=1 По 60 Цикл
					Попытка
						//	Чтение данных по каждой строке
						НоменклатураПЭО=СпрНоменклатура.Командировка;
						Колонка=1;
						Пункт=СокрЛП(РабЗона.Cells(НомерСтроки,1).Value);
						Если Пункт="" Тогда
							Продолжить;
						КонецЕсли; 
						Колонка=2;
						Цель=СокрЛП(РабЗона.Cells(НомерСтроки,2).Value);
						Колонка=3;
						КолвоРаботниковТекст=СокрЛП(РабЗона.Cells(НомерСтроки,3).Value);
						КолвоРаботников=?(КолвоРаботниковТекст="", 0, Число(КолвоРаботниковТекст));
						Колонка=4;
						ПродлжительностьТекст=СокрЛП(РабЗона.Cells(НомерСтроки,4).Value);
						Продлжительность=?(ПродлжительностьТекст="", 0, Число(ПродлжительностьТекст));
						Колонка=5;
						ПродлжительностьВсего=КолвоРаботников*Продлжительность;
						Колонка=6;
						СуточныеТекст=СокрЛП(РабЗона.Cells(НомерСтроки,6).Value);
						Суточные=?(СуточныеТекст="", 0, Число(СуточныеТекст));
						Колонка=7;
						СуточныеВсего=ПродлжительностьВсего*Суточные;
						Колонка=8;
						КвартирныеТекст=СокрЛП(РабЗона.Cells(НомерСтроки,8).Value);
						Квартирные=?(КвартирныеТекст="", 0, Число(КвартирныеТекст));
						Колонка=9;
						КвартирныеВсего=ПродлжительностьВсего*Квартирные;
						Колонка=10;
						ПроездТекст=СокрЛП(РабЗона.Cells(НомерСтроки,10).Value);
						Проезд=?(ПроездТекст="", 0, Число(ПроездТекст));
						Колонка=11;
						ПроездВсего=КолвоРаботников*Проезд;
						Колонка=12;
						ИтогоЗатрат=СуточныеВсего+КвартирныеВсего+ПроездВсего;
						//	Запись данных по каждой строке
						ЗатратыНаКомандировки=Док.ЗатратыНаКомандировки.Добавить();
						ЗатратыНаКомандировки.НоменклатураПЭО=НоменклатураПЭО;
						ЗатратыНаКомандировки.Пункт=Пункт;
						ЗатратыНаКомандировки.Цель=Цель;
						ЗатратыНаКомандировки.КолвоРаботников=КолвоРаботников;
						ЗатратыНаКомандировки.Продлжительность=Продлжительность;
						ЗатратыНаКомандировки.ПродлжительностьВсего=ПродлжительностьВсего;
						ЗатратыНаКомандировки.Суточные=Суточные;
						ЗатратыНаКомандировки.СуточныеВсего=СуточныеВсего;
						ЗатратыНаКомандировки.Квартирные=Квартирные;
						ЗатратыНаКомандировки.КвартирныеВсего=КвартирныеВсего;
						ЗатратыНаКомандировки.Проезд=Проезд;
						ЗатратыНаКомандировки.ПроездВсего=ПроездВсего;
						ЗатратыНаКомандировки.ИтогоЗатрат=ИтогоЗатрат;
					Исключение
						Состояние=Ложь;
						Сообщить("Ошибка: лист-Командировки, строка № "+Строка(НомерСтроки)+", колонка № "+Строка(Колонка), СтатусСообщения.БезСтатуса);
					КонецПопытки;
				КонецЦикла;
				Док.Записать(РежимЗаписиДокумента.Запись);
				
			ИначеЕсли (ИмяРаздела="ПРОЧИЕЗАТРАТЫ") и (Состояние=Истина) Тогда
				//ПРОЧИЕЗАТРАТЫ
				РабЗона=Лист.Range("B5:E54");
				Для НомерСтроки=1 По 50 Цикл
					Попытка
						//	Чтение данных по каждой строке
						Колонка=1;
						Номенклатура=СокрЛП(РабЗона.Cells(НомерСтроки,1).Value);
						НомПоиск=РасчётыДляПЭО.СтрокаДляОтбора(Номенклатура, 3);
						Если НомПоиск="" Тогда
							Продолжить;
						КонецЕсли; 
						НоменклатураПЭО=СпрНоменклатура.НайтиПоРеквизиту("УникальноеНаименование", НомПоиск, СпрНоменклатура.Прочие);
						Если НоменклатураПЭО=СпрНоменклатура.ПустаяСсылка() Тогда
							Номенклатура2=СпрНоменклатура.СоздатьЭлемент();
							Номенклатура2.Родитель=СпрНоменклатура.Прочие;
							Номенклатура2.Наименование=Номенклатура;
							Номенклатура2.УникальноеНаименование=НомПоиск;
							Номенклатура2.Записать();
							НоменклатураПЭО=Номенклатура2.Ссылка;
						КонецЕсли;
						Колонка=2;
						Основание=СокрЛП(РабЗона.Cells(НомерСтроки,2).Value);
						Колонка=3;
						СуммаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,3).Value);
						Сумма=?(СуммаТекст="", 0, Число(СуммаТекст));
						Колонка=4;
						Примечание_Раб=СокрЛП(РабЗона.Cells(НомерСтроки,4).Value);
						//	Запись данных по каждой строке
						ПрочиеЗатраты=Док.ПрочиеЗатраты.Добавить();
						ПрочиеЗатраты.НоменклатураПЭО=НоменклатураПЭО;
						ПрочиеЗатраты.Основание=Основание;
						ПрочиеЗатраты.Сумма=Сумма;
						ПрочиеЗатраты.Примечание=Примечание_Раб;
					Исключение
						Состояние=Ложь;
						Сообщить("Ошибка: лист-ПрочиеЗатраты, строка № "+Строка(НомерСтроки)+", колонка № "+Строка(Колонка), СтатусСообщения.БезСтатуса);
					КонецПопытки;
				КонецЦикла;
				Док.Записать(РежимЗаписиДокумента.Запись);
				
			ИначеЕсли (ИмяРаздела="ПОСТУПЛЕНИЕ") и (Состояние=Истина) Тогда
				//ПОСТУПЛЕНИЕ
				РабЗона=Лист.Range("B5:F48");
				Для НомерСтроки=1 По 44 Цикл
					Попытка
						//	Чтение данных по каждой строке
						Колонка=1;
						Номенклатура=СокрЛП(РабЗона.Cells(НомерСтроки,1).Value);
						НомПоиск=РасчётыДляПЭО.СтрокаДляОтбора(Номенклатура, 3);
						Если НомПоиск="" Тогда
							Продолжить;
						КонецЕсли; 
						НоменклатураПЭО=СпрНоменклатура.НайтиПоРеквизиту("УникальноеНаименование", НомПоиск, СпрНоменклатура.Контракты);
						Если НоменклатураПЭО=СпрНоменклатура.ПустаяСсылка() Тогда
							Номенклатура2=СпрНоменклатура.СоздатьЭлемент();
							Номенклатура2.Родитель=СпрНоменклатура.Контракты;
							Номенклатура2.Наименование=Номенклатура;
							Номенклатура2.УникальноеНаименование=НомПоиск;
							Номенклатура2.Записать();
							НоменклатураПЭО=Номенклатура2.Ссылка;
						КонецЕсли;
						Колонка=2;
						Заказчик=ВРег(СокрЛП(РабЗона.Cells(НомерСтроки,2).Value));
						Колонка=3;
						ДатаНачалаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,3).Value);
						ДатаНачала=?(ДатаНачалаТекст="", "", Дата(ДатаНачалаТекст));
						Колонка=4;
						ДатаОкончанияТекст=СокрЛП(РабЗона.Cells(НомерСтроки,4).Value);
						ДатаОкончания=?(ДатаОкончанияТекст="", "", Дата(ДатаОкончанияТекст));
						Колонка=5;
						СуммаТекст=СокрЛП(РабЗона.Cells(НомерСтроки,5).Value);
						Сумма=?(СуммаТекст="", 0, Число(СуммаТекст));
						//	Запись данных по каждой строке
						ПоступлениеСредств=Док.ПоступлениеСредств.Добавить();
						ПоступлениеСредств.НоменклатураПЭО=НоменклатураПЭО;
						ПоступлениеСредств.Заказчик=Заказчик;
						ПоступлениеСредств.ДатаНачала=ДатаНачала;
						ПоступлениеСредств.ДатаОкончания=ДатаОкончания;
						ПоступлениеСредств.Сумма=Сумма;
					Исключение
						Состояние=Ложь;
						Сообщить("Ошибка: лист-Поступление, строка № "+Строка(НомерСтроки)+", колонка № "+Строка(Колонка), СтатусСообщения.БезСтатуса);
					КонецПопытки;
				КонецЦикла;
				Док.Записать(РежимЗаписиДокумента.Запись);
			КонецЕсли;
			
		КонецЦикла;
		Ексел.Application.Quit();
		Ексел.Quit();
		
		//Если файл загружен нормально, то удаляем его
		Если Состояние=Истина Тогда
			Док.ХранилищеЕксел=Новый ХранилищеЗначения(Новый ДвоичныеДанные(ПутьФайла), Новый СжатиеДанных(9));
			Док.Записать(РежимЗаписиДокумента.Запись);
			ЗафиксироватьТранзакцию();
			Попытка
				УдалитьФайлы(СписокФайлов[Ном].Путь, СписокФайлов[Ном].Имя);
			Исключение
				Сообщить(ОписаниеОшибки());
			КонецПопытки;
   			Сообщить("Файл удачно загружен.", СтатусСообщения.БезСтатуса);
		Иначе 
   			Сообщить("Файл НЕ загружен - "+ПутьФайла, СтатусСообщения.Важное);
		КонецЕсли; 
	КонецЦикла;
	Ексел = Неопределено;
	Сообщить("-------------------------------------------------------------------------------------");
	Сообщить("Загрзка завершена!", СтатусСообщения.БезСтатуса);
	
КонецПроцедуры

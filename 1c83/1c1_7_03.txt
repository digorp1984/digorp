//сравнить структуру с файлом
Процедура ОсновныеДействияФормыДействие2(Кнопка)
	
	//общие реквизиты
	НомГлавный=-1;
	МассивГлавный=Новый Массив(100,7);
	НомФаил=-1;
	МассивФаил=Новый Массив(100,4);
	
	//чтение полей - настройки
	ВыборкаПоля=ПлолучитьВыборкуПолей();
	Пока ВыборкаПоля.Следующий() Цикл
		НомГлавный=НомГлавный+1;
		МассивГлавный[НомГлавный][0]=СокрЛП(ВыборкаПоля.Поле);
		МассивГлавный[НомГлавный][1]=ВыборкаПоля.НомерПП;
		МассивГлавный[НомГлавный][2]=ВыборкаПоля.ДлинаПоля;
		МассивГлавный[НомГлавный][3]="";
		МассивГлавный[НомГлавный][4]=0;
		МассивГлавный[НомГлавный][5]=0;
		МассивГлавный[НомГлавный][6]=0;
	КонецЦикла;
	
	//чтение полей - файла
	ФаилПутьОбщий1=СокрЛП(Константы.ПутьДБФдляЗагрузки1.Получить());
	ФаилПутьОбщий2=СокрЛП(Константы.ПутьДБФдляЗагрузки2.Получить());
	ФаилПутьОбщий3=СокрЛП(Константы.ПутьДБФдляЗагрузки3.Получить());
	ФаилПутьОбщий4=СокрЛП(Константы.ПутьДБФдляЗагрузки4.Получить());
	ФаилПутьОбщий5=СокрЛП(Константы.ПутьДБФдляЗагрузки5.Получить());
	ФаилПутьОбщий6=СокрЛП(Константы.ПутьДБФдляЗагрузки6.Получить());
	ФаилПутьОбщий7=СокрЛП(Константы.ПутьДБФдляЗагрузки7.Получить());
	ФаилПутьОбщий8=СокрЛП(Константы.ПутьДБФдляЗагрузки8.Получить());
	ФаилПутьОбщий9=СокрЛП(Константы.ПутьДБФдляЗагрузки9.Получить());
	ФаилПутьОбщий10=СокрЛП(Константы.ПутьДБФдляЗагрузки10.Получить());
	ФаилПутьОбщий11=СокрЛП(Константы.ПутьДБФдляЗагрузки11.Получить());
	ФаилПутьОбщий12=СокрЛП(Константы.ПутьДБФдляЗагрузки12.Получить());
	Фаил319=ФаилПутьОбщий1+?(Прав(ФаилПутьОбщий1, 1)<>"\", "\", "")+"S319.DBF";
	Фаил320=ФаилПутьОбщий2+?(Прав(ФаилПутьОбщий2, 1)<>"\", "\", "")+"S320.DBF";
	Фаил321=ФаилПутьОбщий3+?(Прав(ФаилПутьОбщий3, 1)<>"\", "\", "")+"S321.DBF";
	Фаил323=ФаилПутьОбщий4+?(Прав(ФаилПутьОбщий4, 1)<>"\", "\", "")+"S323.DBF";
	Фаил548=ФаилПутьОбщий5+?(Прав(ФаилПутьОбщий5, 1)<>"\", "\", "")+"S548.DBF";
	Фаил631=ФаилПутьОбщий7+?(Прав(ФаилПутьОбщий7, 1)<>"\", "\", "")+"S631.DBF";
	Фаил651=ФаилПутьОбщий11+?(Прав(ФаилПутьОбщий11, 1)<>"\", "\", "")+"S651.DBF";
	Фаил652=ФаилПутьОбщий12+?(Прав(ФаилПутьОбщий12, 1)<>"\", "\", "")+"S652.DBF";
	ПрефиксГода=Прав(Строка(Год(ТекущаяДата())),2);
	ФаилFADD=ФаилПутьОбщий6+?(Прав(ФаилПутьОбщий6, 1)<>"\", "\", "")+"FADD"+ПрефиксГода+".DBF";
	ФаилFSUM=ФаилПутьОбщий6+?(Прав(ФаилПутьОбщий6, 1)<>"\", "\", "")+"FSUM"+ПрефиксГода+".DBF";
	Фаил822=ФаилПутьОбщий8+?(Прав(ФаилПутьОбщий8, 1)<>"\", "\", "")+"S822.DBF";
	Фаил823=ФаилПутьОбщий9+?(Прав(ФаилПутьОбщий9, 1)<>"\", "\", "")+"S823.DBF";
	Фаил824=ФаилПутьОбщий10+?(Прав(ФаилПутьОбщий10, 1)<>"\", "\", "")+"S824.DBF";
	
	ФаилИтог=Фаил319;
	Если ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил320 Тогда
		ФаилИтог=Фаил320;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил321 Тогда
		ФаилИтог=Фаил321;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил323 Тогда
		ФаилИтог=Фаил323;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил548 Тогда
		ФаилИтог=Фаил548;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил631 Тогда
		ФаилИтог=Фаил631;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.ФаилFADD Тогда
		ФаилИтог=ФаилFADD;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.ФаилFSUM Тогда
		ФаилИтог=ФаилFSUM;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил822 Тогда
		ФаилИтог=Фаил822;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил823 Тогда
		ФаилИтог=Фаил823;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил824 Тогда
		ФаилИтог=Фаил824;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил651 Тогда
		ФаилИтог=Фаил651;
	ИначеЕсли ЭлементыФормы.ПолеВвода1.Значение=Перечисления.ВидыФаловДОС.Фаил652 Тогда
		ФаилИтог=Фаил652;
	КонецЕсли;
	
	ДБФ = Новый XBase;
	Попытка
		ДБФ.ОткрытьФайл(ФаилИтог,,Истина);
	Исключение
		Предупреждение("Ошибка открытия файла " + ФаилИтог);
		Возврат;
	КонецПопытки;        
	Если НЕ ДБФ.Открыта() Тогда
		Предупреждение("Ошибка открытия файла " + ФаилИтог);
		Возврат;
	КонецЕсли;
	ДБФ.Кодировка = КодировкаXBase.OEM; 
	НомФаил=ДБФ.поля.Количество()-1;
	Для НомПоля=0 По НомФаил Цикл
		ПолеДБФ=ДБФ.поля.Получить(НомПоля);
		МассивФаил[НомПоля][0]=СокрЛП(ПолеДБФ.Имя);
		МассивФаил[НомПоля][1]=НомПоля+1;
		МассивФаил[НомПоля][2]=ПолеДБФ.Длина;
		МассивФаил[НомПоля][3]=0;
	КонецЦикла;
	ДБФ.ЗакрытьФайл();
	
	//объединение массивов
	Для Ном1=0 По НомГлавный Цикл
		Для Ном2=0 По НомФаил Цикл
			Если МассивГлавный[Ном1][1]=МассивФаил[Ном2][1] Тогда
				МассивГлавный[Ном1][3]=МассивФаил[Ном2][0];
				МассивГлавный[Ном1][4]=МассивФаил[Ном2][1];
				МассивГлавный[Ном1][5]=МассивФаил[Ном2][2];
				МассивФаил[Ном2][3]=1;
				Прервать;
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	Для Ном2=0 По НомФаил Цикл
		Если МассивФаил[Ном2][3]=0 Тогда
			НомГлавный=НомГлавный+1;
			МассивГлавный[НомГлавный][0]="";
			МассивГлавный[НомГлавный][1]=0;
			МассивГлавный[НомГлавный][2]=0;
			МассивГлавный[НомГлавный][3]=МассивФаил[Ном2][0];
			МассивГлавный[НомГлавный][4]=МассивФаил[Ном2][1];
			МассивГлавный[НомГлавный][5]=МассивФаил[Ном2][2];
			МассивГлавный[НомГлавный][6]=0;
		КонецЕсли;
	КонецЦикла;
	
	//сравнение
	Для Ном1=0 По НомГлавный Цикл
		Если (МассивГлавный[Ном1][1]<>МассивГлавный[Ном1][4]) ИЛИ
			(МассивГлавный[Ном1][2]<>МассивГлавный[Ном1][5]) Тогда
			МассивГлавный[Ном1][6]=1;
		КонецЕсли;
	КонецЦикла;
	
	//вывод результата
	ТабДок = Новый ТабличныйДокумент;
	Макет = РегистрыСведений.СтруктураПолейФайовДОС.ПолучитьМакет("СравнениеСтруктуры");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьСтрока = Макет.ПолучитьОбласть("ОблСтрока");
	ОбластьСтрокаРасхождение = Макет.ПолучитьОбласть("ОблСтрокаРасхождение");
	
	ЗаголовокТекст="Анализ полей: "+СокрЛП(ЭлементыФормы.ПолеВвода1.Значение);
	ОбластьШапка.Параметры.ЗаголовокТекст=ЗаголовокТекст;
	ТабДок.Вывести(ОбластьШапка);
	
	Для НомЭлемента=0 По НомГлавный Цикл
		Если МассивГлавный[НомЭлемента][6]=1 Тогда
			ОбластьСтрокаИтог=ОбластьСтрокаРасхождение;
		Иначе
			ОбластьСтрокаИтог=ОбластьСтрока;
		КонецЕсли;
		ОбластьСтрокаИтог.Параметры.Поле1=МассивГлавный[НомЭлемента][0];
		ОбластьСтрокаИтог.Параметры.Номер1=МассивГлавный[НомЭлемента][1];
		ОбластьСтрокаИтог.Параметры.КолСимв1=МассивГлавный[НомЭлемента][2];
		ОбластьСтрокаИтог.Параметры.Поле2=МассивГлавный[НомЭлемента][3];
		ОбластьСтрокаИтог.Параметры.Номер2=МассивГлавный[НомЭлемента][4];
		ОбластьСтрокаИтог.Параметры.КолСимв2=МассивГлавный[НомЭлемента][5];
		ТабДок.Вывести(ОбластьСтрокаИтог);
	КонецЦикла;
	
	УниверсальныеМеханизмы.НапечататьДокумент(ТабДок, 1, Ложь, ЗаголовокТекст);
	
КонецПроцедуры

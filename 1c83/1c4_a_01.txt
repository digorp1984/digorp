//-----------------------------------------------
// 2. Нормы
//-----------------------------------------------

Процедура ЗагрузитьНормыИз1С() Экспорт
	
	ЗапросНормы=Новый Запрос;
	ЗапросНормы.Текст="ВЫБРАТЬ
	                  |	СотрудникиОрганизаций.Ссылка КАК Сотрудник,
	                  |	СотрудникиОрганизаций.Наименование КАК ФИО
	                  |ПОМЕСТИТЬ ТблВыборкаСотрудников
	                  |ИЗ
	                  |	Справочник.СотрудникиОрганизаций КАК СотрудникиОрганизаций
	                  |ГДЕ
	                  |	СотрудникиОрганизаций.ПометкаУдаления = ЛОЖЬ
	                  |	И СотрудникиОрганизаций.Актуальность = ИСТИНА
	                  |	И СотрудникиОрганизаций.ДатаУвольнения = &ПустаяДата
	                  |	И СотрудникиОрганизаций.ВидЗанятости = &ВидЗанятости
	                  |;
	                  |
	                  |////////////////////////////////////////////////////////////////////////////////
	                  |ВЫБРАТЬ
	                  |	ЗначенияСвойствОбъектов.Объект КАК Сотрудник,
	                  |	ЗначенияСвойствОбъектов.Значение КАК Норма
	                  |ПОМЕСТИТЬ ТюлВыборкаНомр
	                  |ИЗ
	                  |	РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
	                  |ГДЕ
	                  |	ЗначенияСвойствОбъектов.Свойство = &СвойствоСотрудника
	                  |;
	                  |
	                  |////////////////////////////////////////////////////////////////////////////////
	                  |ВЫБРАТЬ
	                  |	ТблВыборкаСотрудников.Сотрудник,
	                  |	ТблВыборкаСотрудников.ФИО КАК ФИО,
	                  |	ЕСТЬNULL(ТюлВыборкаНомр.Норма, 0) КАК Норма
	                  |ИЗ
	                  |	ТблВыборкаСотрудников КАК ТблВыборкаСотрудников
	                  |		ЛЕВОЕ СОЕДИНЕНИЕ ТюлВыборкаНомр КАК ТюлВыборкаНомр
	                  |		ПО ТблВыборкаСотрудников.Сотрудник = ТюлВыборкаНомр.Сотрудник
	                  |
	                  |УПОРЯДОЧИТЬ ПО
	                  |	ФИО";
	ЗапросНормы.УстановитьПараметр("ПустаяДата",Дата(1,1,1));
	ЗапросНормы.УстановитьПараметр("СвойствоСотрудника",ПолучитьСвойствоРасширенияЗоны());
	ЗапросНормы.УстановитьПараметр("ВидЗанятости",Перечисления.ВидыЗанятостиВОрганизации.ОсновноеМестоРаботы);
	ТблНормы=ЗапросНормы.Выполнить().Выгрузить();
	Нормы.Загрузить(ТблНормы);
	
КонецПроцедуры

Процедура СохранитьНормыВ1С() Экспорт
	
	//общие параметры
	СвойствоРЗ=ПолучитьСвойствоРасширенияЗоны();
	
	//запись построчно
	Для Каждого СтрНормы Из Нормы Цикл
		Если СтрНормы.Норма=0 Тогда
			Продолжить;
		КонецЕсли;
		
		МенеджерЗначения=РегистрыСведений.ЗначенияСвойствОбъектов.СоздатьНаборЗаписей();
		МенеджерЗначения.Отбор.Объект.Установить(СтрНормы.Сотрудник);
		МенеджерЗначения.Отбор.Свойство.Установить(СвойствоРЗ);
		МенеджерЗначения.Прочитать();
		МенеджерЗначения.Очистить();
		
		НовоеЗначение=МенеджерЗначения.Добавить();
		НовоеЗначение.Объект=СтрНормы.Сотрудник;
		НовоеЗначение.Свойство=СвойствоРЗ;
		НовоеЗначение.Значение=СтрНормы.Норма;
		МенеджерЗначения.Записать();
	КонецЦикла;
	
КонецПроцедуры

#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	ДокументРезультат.Очистить();
	
	НастройкиОтчета = КомпоновщикНастроек.ПолучитьНастройки();				   
		
	Попытка
		
		СтандартнаяОбработка = Ложь;
		
		//параметры отчета
		НачПериод = Дата(1,1,1);
		КонПериод = Дата(1,1,1);
		Параметр = НастройкиОтчета.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
		Если ЗначениеЗаполнено(Параметр.Значение) Тогда
			НачПериод = НачалоГода(Параметр.Значение);
			КонПериод = КонецГода(Параметр.Значение);
		КонецЕсли;
		
		ТекстПериода = "с " + Формат(НачПериод, "ДФ=dd.MM.yyyy") + " по " + Формат(КонПериод, "ДФ=dd.MM.yyyy");
		
		Параметр = НастройкиОтчета.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Организация"));
		Организация = Параметр.Значение;
		
		Параметр = НастройкиОтчета.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("ВывестиРасшифровкуПлана"));
		ВывестиРасшифровкуПлана = Параметр.Значение;
		
		Параметр = НастройкиОтчета.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Проект"));
		Проект = Параметр.Значение;
		
		ПараметрыОтчета = Новый Структура;
		ПараметрыОтчета.Вставить("НачПериод", 				НачПериод);
		ПараметрыОтчета.Вставить("КонПериод", 				КонПериод);
		ПараметрыОтчета.Вставить("ТекстПериода", 			ТекстПериода);
		ПараметрыОтчета.Вставить("Организация", 			Организация);
		ПараметрыОтчета.Вставить("ОрганизацияТекст", 		СокрЛП(Организация.НаименованиеСокращенное));
		ПараметрыОтчета.Вставить("ВывестиРасшифровкуПлана", ВывестиРасшифровкуПлана);
		ПараметрыОтчета.Вставить("Проект", 					Проект);
		ПараметрыОтчета.Вставить("ВключитьОтборПоПроекту", 	?(Проект = Справочники.СтатьиФинансированияЗарплата.ПустаяСсылка(),Ложь,Истина));
		
		// Параметры документа
		ДокументРезультат.ТолькоПросмотр = Истина;
		ДокументРезультат.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_АФМ_ВыплатаКЮбилейнымДатам_версия1";
		ДокументРезультат.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
		
		Данные = Новый ДеревоЗначений;
		
		КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
		МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, НастройкиОтчета,,, Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
		
		// Создадим и инициализируем процессор компоновки.
		ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
		ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, , , Истина);
		
		ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений;
		ПроцессорВывода.УстановитьОбъект(Данные);
		
		// Обозначим начало вывода
		ПроцессорВывода.Вывести(ПроцессорКомпоновки, Истина);
		
		// Вывод отчета
		Если ВывестиРасшифровкуПлана = Истина Тогда
			ВывестиРасшифровку(ДокументРезультат, Данные, ПараметрыОтчета);
		Иначе
			ВывестиМакет(ДокументРезультат, Данные, ПараметрыОтчета);
		КонецЕсли;
		
	Исключение
		Инфо = ИнформацияОбОшибке();
		ВызватьИсключение НСтр("ru = 'В настройку отчета внесены критичные изменения. Отчет не будет сформирован.'") + " " + Инфо.Описание;
	КонецПопытки;
	
КонецПроцедуры

#КонецОбласти

&НаСервере
Функция ПолучитьТекстСРазделителями(СтруктураДанных)		
	Возврат Обработки.ОФК_МенеджерВыгрузкиПроводокВRSBank.ПолучитьТекстСРазделителями(СтруктураДанных);
КонецФункции


......................


// Формирование текстового файла для отправки в RS банк
//
Функция ПолучитьТекстСРазделителями(СтруктураДанных) Экспорт		
	
	ПоляВыгрузки = Новый Структура("Номер, Дата, СчетДебета, СчетКредита, Сумма, Валюта, ШифрДокумента, Назначение, НомерПачки, КодОперациониста",
		"", "", "СчетДебета", "СчетКредита", "Сумма", "", "", "Содержание", "", "");
		
	// фиксированные значения	
	ЗначенияПолей = Новый Структура("ШифрДокумента, НомерПачки, Дата", "09", "750", Формат(СтруктураДанных.Дата, "ДФ=dd.MM.yyyy"));
	
	// готовим шапку
	Текст = "";
	Для Каждого Поле Из ПоляВыгрузки Цикл
		Текст = Текст + """"+Поле.Ключ+""";";
	КонецЦикла;
		
	// убираем ";"
	КолвоСтрок = 0;
	Текст = Сред(Текст, 1, СтрДлина(Текст)-1);
	
	Для Каждого СтрокаТаблицы Из СтруктураДанных.СвернутыеПроводки Цикл
		
		//счетчик
		КолвоСтрок = КолвоСтрок + 1;
		
		//фомирование строки
		Текст = Текст + "
			|";
		
		Для Каждого Поле Из ПоляВыгрузки Цикл						
			
			Если ЗначениеЗаполнено(Поле.Значение) Тогда
				Текст = Текст + """"+ПривестиКФормату(СтрокаТаблицы[Поле.Значение])+"""";
			Иначе
				Если ЗначенияПолей.Свойство(Поле.Ключ) Тогда
					Текст = Текст + """"+ЗначенияПолей[Поле.Ключ]+"""";
				Иначе
					Текст = Текст + """""";	
				КонецЕсли;
			КонецЕсли;
			Текст = Текст + ";";
			
		КонецЦикла;
		
		// убираем ";"
		Текст = Сред(Текст, 1, СтрДлина(Текст)-1);
				
	КонецЦикла;
	
	// завершение
	Если КолвоСтрок = 0 Тогда
		Текст = "";
	КонецЕсли;
	Возврат Текст;
	
КонецФункции

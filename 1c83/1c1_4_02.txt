Процедура ОбработкаПроведения(Отказ, Режим)

	//проверки
	ОшибкаЗаполнения=Ложь;
	Если ДтСчет.Пустая() Тогда
		Сообщить("Заполните реквизит - ДтСчет");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если ДтКБК.Пустая() Тогда
		Сообщить("Заполните реквизит - ДтКБК");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если ДтКОСГУ.Пустая() Тогда
		Сообщить("Заполните реквизит - ДтКОСГУ");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если ДтКонтрагент.Пустая() Тогда
		Сообщить("Заполните реквизит - ДтКонтрагент");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если КтСчет.Пустая() Тогда
		Сообщить("Заполните реквизит - КтСчет");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если КтКБК.Пустая() Тогда
		Сообщить("Заполните реквизит - КтКБК");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если КтКОСГУ.Пустая() Тогда
		Сообщить("Заполните реквизит - КтКОСГУ");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если КФО.Пустая() Тогда
		Сообщить("Заполните реквизит - КФО");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если Общежитие.Пустая() Тогда
		Сообщить("Заполните реквизит - Общежитие");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если Учреждение.Пустая() Тогда
		Сообщить("Заполните реквизит - Учреждение");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Если Начислено.Итог("Итого")=0 Тогда
		Сообщить("Не заполнена ТЧ документа");
		ОшибкаЗаполнения=Истина;
	КонецЕсли;
	Для Каждого СтрДок Из Начислено Цикл
		Если СтрДок.ПериодНачисленияТЧ=Дата(1,1,1) Тогда
			Сообщить("Заполните реквизит - Период начисления, строка в табличной части = "+СокрЛП(СтрДок.НомерСтроки));
			ОшибкаЗаполнения=Истина;
		КонецЕсли;
	КонецЦикла;
	Если ОшибкаЗаполнения=Истина Тогда
		Отказ=Истина;
		Возврат;
	КонецЕсли;
	
	//бух. операции
	Движения.ЕПСБУ.Записывать = Истина;
	Движения.ЕПСБУ.Очистить();
	
	Движение = Движения.ЕПСБУ.Добавить();
	Движение.Период = Дата;
	Движение.Учреждение = Учреждение;
	Движение.КВД = КФО;
	Движение.Сумма = Начислено.Итог("Итого");
	Движение.Содержание = "Начисление оплаты по общежитию - "+СокрЛП(Общежитие);
	Движение.НомерЖурнала = БухгалтерскийУчет.НомерЖурнала(ДтСчет, КтСчет);
	
	Движение.СчетДт = ДтСчет;
	Движение.КБКДт = ДтКБК;
	Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконтоБюджет.КОСГУ] = ДтКОСГУ;
	Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконтоБюджет.Контрагенты] = ДтКонтрагент;
	Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконтоБюджет.Договоры] = ДтДоговор;
	
	Движение.СчетКт = КтСчет;
	Движение.КБККт = КтКБК;
	Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконтоБюджет.КОСГУ] = КтКОСГУ;
	
	//регистр УчетЖКУ Приход
	Движения.УчетЖКУ.Записывать = Истина;
	Движения.УчетЖКУ.Очистить();
	Для Каждого ТекСтрокаНачислено Из Начислено Цикл
		Для НомВидНач=1 По 7 Цикл
			СуммаНачисл=ТекСтрокаНачислено.Отопление;
			ВидНачисл=Перечисления.ВидыЖКУ.Отопление;
			Если НомВидНач=2 Тогда
				СуммаНачисл=ТекСтрокаНачислено.ХолВода;
				ВидНачисл=Перечисления.ВидыЖКУ.ХолоднаяВода;
			ИначеЕсли НомВидНач=3 Тогда
				СуммаНачисл=ТекСтрокаНачислено.ГорВода;
				ВидНачисл=Перечисления.ВидыЖКУ.ГорячаяВода;
			ИначеЕсли НомВидНач=4 Тогда
				СуммаНачисл=ТекСтрокаНачислено.Водоотведение;
				ВидНачисл=Перечисления.ВидыЖКУ.Водоотведение;
			ИначеЕсли НомВидНач=5 Тогда
				СуммаНачисл=ТекСтрокаНачислено.ВывозМусора;
				ВидНачисл=Перечисления.ВидыЖКУ.ВывозМусора;
			ИначеЕсли НомВидНач=6 Тогда
				СуммаНачисл=ТекСтрокаНачислено.Квартплата;
				ВидНачисл=Перечисления.ВидыЖКУ.Квартплата;
			ИначеЕсли НомВидНач=7 Тогда
				СуммаНачисл=ТекСтрокаНачислено.Электроэнергия;
				ВидНачисл=Перечисления.ВидыЖКУ.Электроэнергия;
			КонецЕсли;
			Если СуммаНачисл=0 Тогда
				Продолжить;
			КонецЕсли;
			
			Движение = Движения.УчетЖКУ.Добавить();
			Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
			Движение.Период = НачалоМесяца(ТекСтрокаНачислено.ПериодНачисленияТЧ);
			Движение.Учреждение = Учреждение;
			Движение.Общежитие = Общежитие;
			Движение.Сотрудник = ТекСтрокаНачислено.Сотрудник;
			Движение.ВидЖКУ = ВидНачисл;
			Движение.Сумма = СуммаНачисл;
		КонецЦикла;
	КонецЦикла;

	//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
КонецПроцедуры

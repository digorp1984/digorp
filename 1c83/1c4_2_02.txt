#Область Справки2НДФЛ

&НаКлиенте
Процедура Рассчитать3(Команда)
	
	//проверка
	Если Не ПроверитьЗаполнение() Тогда
		Возврат;
	КонецЕсли;
	Если Объект.РасчетСреднегоПриУвольнении.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	//создание справок
	Для Каждого СтрокаТЧ Из Объект.РасчетСреднегоПриУвольнении Цикл
		
		Для НалоговыйПериод = 2016 По 2018 Цикл
			
			Если НалоговыйПериод = 2016 И СтрокаТЧ.Справка2016 = Ложь Тогда
				Продолжить;
			КонецЕсли;
			Если НалоговыйПериод = 2017 И СтрокаТЧ.Справка2017 = Ложь Тогда
				Продолжить;
			КонецЕсли;
			Если НалоговыйПериод = 2018 И СтрокаТЧ.Справка2018 = Ложь Тогда
				Продолжить;
			КонецЕсли;
			
			ПараметрыДокумента = ПолучитьПараметрыСправки2НДФЛ(СтрокаТЧ.Сотрудник, НалоговыйПериод);
			
			ФормаСправки2НДФЛ = ПолучитьФорму("Документ.СправкаНДФЛ.ФормаОбъекта", ПараметрыДокумента, , ПараметрыДокумента.Основание.ИДФормы);
			// Важно! В объекте Документ.СправкаНДФЛ в модуле объекта доработа процедура ОбработкаЗаполнения()
			ФормаСправки2НДФЛ.Открыть();
			
		КонецЦикла;
		
	КонецЦикла;
	
	//завершение
	ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Обработка выполнена!");
	
КонецПроцедуры

&НаСервере
Функция ПолучитьПараметрыСправки2НДФЛ(Сотрудник, НалоговыйПериод)
	
	ИДФормы = Новый УникальныйИдентификатор;
	ИДФормы = СокрЛП(ИДФормы);
	
	ПараметрыДокумента = Новый Структура();
	ПараметрыДокумента.Вставить("Дата", 				Объект.ДатаУвольнения);
	ПараметрыДокумента.Вставить("Организация", 			Объект.Организация);
	ПараметрыДокумента.Вставить("Сотрудник", 			Сотрудник.ФизическоеЛицо);
	ПараметрыДокумента.Вставить("НалоговыйПериод", 		НалоговыйПериод);
	ПараметрыДокумента.Вставить("СпособФормирования", 	Перечисления.ПорядокФормированияСправкиОДоходахФизическогоЛица.Сводно);
	ПараметрыДокумента.Вставить("ИДФормы", 				ИДФормы);
	
	ПараметрыИтог = Новый Структура();
	ПараметрыИтог.Вставить("Основание", ПараметрыДокумента);
	
	Возврат ПараметрыИтог;
	
КонецФункции

#КонецОбласти

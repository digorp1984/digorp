Процедура СформироватьВыгрузкуВФорматеXML() Экспорт
	
	//проверки
	Если Учреждение.Пустая() Тогда
		Сообщить("ОШИБКА: Не заполнен параметр отбора - Учреждение");
		Возврат;
	КонецЕсли;
	Если СокрЛП(КаталогВыгрузки)="" Тогда
		Сообщить("ОШИБКА: Не заполнен - каталог выгрузки");
		Возврат;
	КонецЕсли;
	
	//параметры
	ИмяФайлаДанных=СокрЛП(КаталогВыгрузки)+"ЦСВ_ПП_"+Формат(НачПериод,"ДФ=yyyyMMdd")+"_"+Формат(КонПериод,"ДФ=yyyyMMdd")+".XML";
	ФайлXML=Новый ЗаписьXML;
	ФайлXML.ОткрытьФайл(ИмяФайлаДанных,"windows-1251");
	ФайлXML.ЗаписатьОбъявлениеXML();
	
	//расчет данных
	ТблДанные=СформироватьТаблицуДок();
	ТблЛС=СформироватьТаблицуЛС(ТблДанные);
	Если ТблДанные.Количество()=0 Тогда
		Сообщить("ОШИБКА: Данных для выгрузки не обнаружено!");
		Возврат;
	КонецЕсли;
	
	//выгрузка ЛС
	ФайлXML.ЗаписатьНачалоЭлемента("BGU");
	ФайлXML.ЗаписатьАтрибут("ver","БГУ, редакция 1.0 (1.0.38.3)");
	ФайлXML.ЗаписатьНачалоЭлемента("razdelLS");
	Для Каждого СтрЛС Из ТблЛС Цикл
		ФайлXML.ЗаписатьНачалоЭлемента("LS");
		ФайлXML.ЗаписатьАтрибут("id",СокрЛП(СтрЛС.ЛСКод));
		ЗаписатьУзел(ФайлXML,"lskod",СтрЛС.ЛСКод);
		ЗаписатьУзел(ФайлXML,"lsnaim",СтрЛС.ЛСНаименование);
		ЗаписатьУзел(ФайлXML,"lstip",СтрЛС.ЛСТип);
		ЗаписатьУзел(ФайлXML,"platinn",СтрЛС.ПлатильщикИНН);
		ЗаписатьУзел(ФайлXML,"platkpp",СтрЛС.ПлатильщикКПП);
		ЗаписатьУзел(ФайлXML,"platnaim",СтрЛС.ПлатильщикНаименование);
		ЗаписатьУзел(ФайлXML,"platrs",СтрЛС.ПлатильщикРСЧ);
		ЗаписатьУзел(ФайлXML,"bankbik",СтрЛС.ПлатильщикБанкБИК);
		ЗаписатьУзел(ФайлXML,"banknaim",СтрЛС.ПлатильщикБанкНаименование);
		ФайлXML.ЗаписатьКонецЭлемента();
	КонецЦикла;
	ФайлXML.ЗаписатьКонецЭлемента();
	
	//выгрузка документов
	ФайлXML.ЗаписатьНачалоЭлемента("razdelDOC");
	Для Каждого СтрДок Из ТблДанные Цикл
		Если СтрДок.ППВид=1 Тогда
			ФайлXML.ЗаписатьНачалоЭлемента("PP");
		ИначеЕсли СтрДок.ППВид=2 Тогда
			Если СокрЛП(СтрДок.ЛСКод)="03732D00240" Тогда
				ФайлXML.ЗаписатьНачалоЭлемента("THKR");
			Иначе
				ФайлXML.ЗаписатьНачалоЭлемента("PP");
			КонецЕсли;
		Иначе
			ФайлXML.ЗаписатьНачалоЭлемента("THKR");
		КонецЕсли;
		
		ФайлXML.ЗаписатьАтрибут("id",СокрЛП(СтрДок.ИД));
		ЗаписатьУзел(ФайлXML,"viddoc",Формат(СтрДок.ППВид,"ЧДЦ=; ЧГ=0"));
		ЗаписатьУзел(ФайлXML,"nom",Формат(СтрДок.ППНомер,"ЧДЦ=; ЧГ=0"));
		ЗаписатьУзел(ФайлXML,"data",Формат(СтрДок.ППДата,"ДФ=dd.MM.yyyy"));
		ЗаписатьУзел(ФайлXML,"dataop",Формат(СтрДок.ППДатаОперации,"ДФ=dd.MM.yyyy"));
		ЗаписатьУзел(ФайлXML,"ls",СтрДок.ЛСКод);
		ЗаписатьУзел(ФайлXML,"kontragentinn",СтрДок.ПолучательИНН);
		ЗаписатьУзел(ФайлXML,"kontragentkpp",СтрДок.ПолучательКПП);
		ЗаписатьУзел(ФайлXML,"kontragentnaim",СтрДок.ПолучательНаименование);
		ЗаписатьУзел(ФайлXML,"kontragentrs",СтрДок.ПолучательРСЧ);
		ЗаписатьУзел(ФайлXML,"bankbik",СтрДок.ПолучательБанкБИК);
		ЗаписатьУзел(ФайлXML,"banknaim",СтрДок.ПолучательБанкНаименование);
		ЗаписатьУзел(ФайлXML,"vidplat",СтрДок.ППВидПлатежа);
		ЗаписатьУзел(ФайлXML,"ocheredn",СтрДок.ППОчередностьПлатежа);
		ЗаписатьУзел(ФайлXML,"kodbkd",СтрДок.КодБКД);
		ЗаписатьУзел(ФайлXML,"np",СтрДок.ППНазначениеПлатежа);
		ЗаписатьУзел(ФайлXML,"rasplatkps",СтрДок.КБК);
		ЗаписатьУзел(ФайлXML,"rasplatkak",СтрДок.ЭКР);
		ЗаписатьУзел(ФайлXML,"rasplatsumma",Формат(СтрДок.Сумма,"ЧДЦ=2; ЧРД=.; ЧН=0; ЧГ=0"));
		ФайлXML.ЗаписатьКонецЭлемента();
	КонецЦикла;
	ФайлXML.ЗаписатьКонецЭлемента();
	ФайлXML.ЗаписатьКонецЭлемента();
	
	//завершение
	ФайлXML.Закрыть();
	Сообщить("Выгрузка [ПП и ЗКР] завершена!");
	Сообщить("      "+ИмяФайлаДанных);
	
КонецПроцедуры

//Определение начального показателя спидометра
//	Автомобиль - автомобиль
//	РабДок - вид документа (ПЛ или УНС)
//	НомерДок - номер документа
//	ДатаДок - дата документа
Функция РасчетСтарогоПоказателяСпидометра(Автомобиль, РабДок, НомерДок, ДатаДок) Экспорт
	
	//Общие параметры
	НачПериод=Дата(2007,1,1);
	КонПериод=Дата(Число(ДатаДок)-1);
	КонечныеПоказания=Автомобиль.НачДанныеСпидометра;
	Если КонечныеПоказания=0 Тогда
		Если СокрЛП(Автомобиль.Наименование)<>"" Тогда
			Сообщить("По машине="+СокрЛП(Автомобиль.Наименование)+"  не введены начальные остатки", "!!");
		КонецЕсли;
	КонецЕсли;
	
	ТабПоказатели=СоздатьОбъект("ТаблицаЗначений");
	ТабПоказатели.НоваяКолонка("Дата","Дата");
	ТабПоказатели.НоваяКолонка("ВидДок","Число",1,0);
	ТабПоказатели.НоваяКолонка("Спидометр","Число",11,0);

	//обработка путевых листов
	ДокПЛ=СоздатьОбъект("Документ.ПутевойЛист");
	ДокПЛ.ВыбратьДокументы(НачПериод,КонПериод);
	Пока ДокПЛ.ПолучитьДокумент() = 1 Цикл
		Если ДокПЛ.Проведен()=0 Тогда
			Продолжить;
		КонецЕсли;
		Если (СокрЛП(ДокПЛ.НомерДок)=СокрЛП(НомерДок)) и (РабДок="ПЛ") Тогда
			//исключение текущего документа
			Продолжить;
		КонецЕсли;
		Если ДокПЛ.Автомобиль<>Автомобиль Тогда
			Продолжить;
		КонецЕсли;
		ТабПоказатели.НоваяСтрока();
		ТабПоказатели.Дата = ДокПЛ.ДатаДок;
		ТабПоказатели.ВидДок = 0;
		ТабПоказатели.Спидометр = ДокПЛ.СпидометрКонИт;
	КонецЦикла;
	
	//обработка установок новых показателей
	ДокУНС=СоздатьОбъект("Документ.УстановкаНовогоСпидометра");
	ДокУНС.ВыбратьДокументы(НачПериод,КонПериод);
	Пока ДокУНС.ПолучитьДокумент() = 1 Цикл
		Если ДокУНС.Проведен()=0 Тогда
			Продолжить;
		КонецЕсли;
		Если (СокрЛП(ДокУНС.НомерДок)=СокрЛП(НомерДок)) и (РабДок="УНС") Тогда
			//исключение текущего документа
			Продолжить;
		КонецЕсли;
		Если ДокУНС.Автомобиль<>Автомобиль Тогда
			Продолжить;
		КонецЕсли;
		ТабПоказатели.НоваяСтрока();
		ТабПоказатели.Дата = ДокУНС.ДатаДок;
		ТабПоказатели.ВидДок = 1;
		ТабПоказатели.Спидометр = ДокУНС.СпидометрНовый;
	КонецЦикла;
	
	ТабПоказатели.Сортировать("Дата +, ВидДок +");
	ТабПоказатели.ВыбратьСтроки();
	Пока ТабПоказатели.ПолучитьСтроку() = 1 Цикл
		КонечныеПоказания=ТабПоказатели.Спидометр;
	КонецЦикла;
	
	//завершение
	Возврат КонечныеПоказания;

КонецФункции
